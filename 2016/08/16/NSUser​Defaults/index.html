<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>NSUserDefaults使用 | shujucn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="NSUserDefaults官方文档NSUserDefaultsNSUserDefaults 是iOS Foundation 框架提供的一种用于存储管理单例。 Tip 1：支持存储的类型 NSArray NSData NSDictionary NSNumber NSString  通过NSData可以存储大部分类型的文件，例如要存储一张图片可以先把图片转为NSData。 // Create ins">
<meta name="keywords" content="NSUserDefaults">
<meta property="og:type" content="article">
<meta property="og:title" content="NSUserDefaults使用">
<meta property="og:url" content="/2016/08/16/NSUser​Defaults/index.html">
<meta property="og:site_name" content="shujucn">
<meta property="og:description" content="NSUserDefaults官方文档NSUserDefaultsNSUserDefaults 是iOS Foundation 框架提供的一种用于存储管理单例。 Tip 1：支持存储的类型 NSArray NSData NSDictionary NSNumber NSString  通过NSData可以存储大部分类型的文件，例如要存储一张图片可以先把图片转为NSData。 // Create ins">
<meta property="og:updated_time" content="2017-05-16T10:55:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NSUserDefaults使用">
<meta name="twitter:description" content="NSUserDefaults官方文档NSUserDefaultsNSUserDefaults 是iOS Foundation 框架提供的一种用于存储管理单例。 Tip 1：支持存储的类型 NSArray NSData NSDictionary NSNumber NSString  通过NSData可以存储大部分类型的文件，例如要存储一张图片可以先把图片转为NSData。 // Create ins">
  
    <link rel="alternate" href="/atom.xml" title="shujucn" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css">
</head>

  
    
      <body>
    
  
      <div id="container" class="container">
        <article id="post-NSUser​Defaults" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS"></a>
    
  </nav>
</header>

  <hr/>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      NSUserDefaults使用
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <h3 id="NSUserDefaults官方文档"><a href="#NSUserDefaults官方文档" class="headerlink" title="NSUserDefaults官方文档"></a><a href="https://developer.apple.com/reference/foundation/userdefaults" target="_blank" rel="external">NSUserDefaults官方文档</a></h3><h2 id="NSUserDefaults"><a href="#NSUserDefaults" class="headerlink" title="NSUserDefaults"></a>NSUserDefaults</h2><p>NSUserDefaults 是iOS Foundation 框架提供的一种用于存储管理单例。</p>
<h3 id="Tip-1：支持存储的类型"><a href="#Tip-1：支持存储的类型" class="headerlink" title="Tip 1：支持存储的类型"></a>Tip 1：支持存储的类型</h3><ul>
<li>NSArray</li>
<li>NSData</li>
<li>NSDictionary</li>
<li>NSNumber</li>
<li>NSString</li>
</ul>
<p>通过NSData可以存储大部分类型的文件，例如要存储一张图片可以先把图片转为NSData。</p>
<pre><code>// Create instances of NSData
NSData *imageData = UIImageJPEGRepresentation(contactImage, 100);
// Store the data
NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
[defaults setObject:imageData forKey:@&quot;image&quot;];
</code></pre><h3 id="Tip-2-存储使用方法"><a href="#Tip-2-存储使用方法" class="headerlink" title="Tip 2: 存储使用方法"></a>Tip 2: 存储使用方法</h3><pre><code>NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
[defaults setInteger:9001 forKey:@&quot;HighScore&quot;];
[defaults synchronize];
</code></pre><h3 id="Tip-3-获取存储的data"><a href="#Tip-3-获取存储的data" class="headerlink" title="Tip 3: 获取存储的data"></a>Tip 3: 获取存储的data</h3><pre><code>// Get the stored data before the view loads
NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
NSData *imageData = [defaults dataForKey:@&quot;image&quot;];
UIImage *contactImage = [UIImage imageWithData:imageData];
</code></pre><h3 id="Tip-4-对于常见的值类型，如Bool，Float，Integer-等可以使用系统提供的一些方法来存储不同类型值。"><a href="#Tip-4-对于常见的值类型，如Bool，Float，Integer-等可以使用系统提供的一些方法来存储不同类型值。" class="headerlink" title="Tip 4: 对于常见的值类型，如Bool，Float，Integer 等可以使用系统提供的一些方法来存储不同类型值。"></a>Tip 4: 对于常见的值类型，如Bool，Float，Integer 等可以使用系统提供的一些方法来存储不同类型值。</h3><pre><code>- setBool:forKey:
- setFloat:forKey:
- setInteger:forKey:
- setDouble:forKey:
- setURL:forKey:
</code></pre><p>对于存储Bool类型值，取值的时候需要注意使用Bool变量来接住，而不是直接判断对[[NSUserDefaults standardUserDefaults] boolForKey:]，直接判断表示[NSUserDefaults standardUserDefaults] 是否能取到对应的Key值，YES表示has value，NO表示no value。</p>
<pre><code>[[NSUserDefaults standardUserDefaults] setBool:YES forKey:APP_IS_FIRST_SESSION_ID];
BOOL flag = [[NSUserDefaults standardUserDefaults] boolForKey:APP_IS_FIRST_SESSION_ID];
//这里的Flag为YES
if ([[NSUserDefaults standardUserDefaults] boolForKey:APP_IS_FIRST_SESSION_ID]) {
 //直接对取值判断，将总是True，这个代表[NSUserDefaults standardUserDefaults]能取到值
}
</code></pre><h3 id="Tip-5-NSUserDefaults域"><a href="#Tip-5-NSUserDefaults域" class="headerlink" title="Tip 5: NSUserDefaults域"></a>Tip 5: NSUserDefaults域</h3><p>user defaults数据库中其实是由多个层级的域组成的，当你读取一个键值的数据时，NSUserDefaults从上到下透过域的层级寻找正确的值，不同的域有不同的功能，有些域是可持久的，有些域则不行。</p>
<ul>
<li>应用域（application domain）是最重要的域，它存储着你app通过NSUserDefaults<br>set…forKey添加的设置。</li>
<li>注册域（registration domain）仅有较低的优先权，只有在应用域没有找到值时才从注册域去寻找。</li>
<li>全局域（global domain）则存储着系统的设置</li>
<li>语言域（language-specific domains）则包括地区、日期等</li>
<li>参数域（ argument domain）有最高优先权</li>
</ul>
<p>注意需要在每次启动app并且没有在user defaules中读取数据的时候调用以上方法，因为registerDefaults:不能把这些默认数据存储到硬盘上，所以application:didFinishLaunchingWithOptions是最合适的地方。</p>
<pre><code> NSURL *defaultPrefsFile = [[NSBundle mainBundle]
URLForResource:@&quot;DefaultPreferences&quot; withExtension:@&quot;plist&quot;];
NSDictionary *defaultPrefs = [NSDictionary dictionaryWithContentsOfURL:defaultPrefsFile];
[[NSUserDefaults standardUserDefaults] registerDefaults:defaultPrefs];
</code></pre><p>这样做的原因是：默认情况下，应用域是空的，没见键也没有值。当应用第一次设置某项用户偏好设置的值时，相应的值会通过指定的键加入应用域。当通过NSUserDefaults获取某项用户偏好设置的值时，NSUserDefaults会先在应用域中查找，如果找到了值，NSUserDefaults就会返回这个值。如果没有找到，NSUserDefaults就会在注册域中查找并返回默认值。<br>user defaults数据库中其实是由多个层级的域组成的，当你读取一个键值的数据时，NSUserDefaults从上到下透过域的层级寻找正确的值，不同的域有不同的功能，有些域是可持久的，有些域则不行。</p>

      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2016/08/16/NSUser​Defaults/" class="article-date">
  <time datetime="2016-08-16T10:19:10.000Z" itemprop="datePublished">2016-08-16</time>
</a>

        </li>
        
          <li>
            <span class="label">Categoría:</span>
            
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据库及存储/">数据库及存储</a>
  </div>


          </li>
        
        
          <li>
            <span class="label">Tag:</span>
            
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NSUserDefaults/">NSUserDefaults</a></li></ul>


          </li>
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <span id="article-nav-newer" class="article-nav-link-wrap newer"></span>
  
  
    <a href="/2016/02/16/OAuth 2.0/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Viejo</strong>
      <div class="article-nav-title">GCD概要及实现原理</div>
    </a>
  
</nav>


  
</article>




      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr/>
      <div id="footerContent" class="footer-content">
        <p>ipsum dolor sit amet, <strong>consectetur adipiscing elit.</strong> Fusce eget urna vitae velit <em>eleifend interdum at ac nisi. In nec ligula lacus. Cum sociis natoque</em> penatibus et magnis dis parturient montes, nascetur ridiculus mus. Sed eu cursus erat, ut dapibus quam. Post</p>


      </div>
    </footer>

      

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
